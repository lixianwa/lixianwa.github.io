<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Go语言SOLID实践系列五之依赖反转原则 | Lionel's Blog</title><link href=/favicon.ico rel="shortcut icon" type=image/x-icon><meta name=author content="归零"><meta name=description content="引用wikipedia上对依赖反转原则的解释：
 在面向对象编程领域中，依赖反转原则（Dependency inversion principle，DIP）是指一种特定的解耦（传统的依赖关系创建在高层次上，而具体的策略设置则应用在低层次的模块上）形式，使得高层次的模块不依赖于低层次的模块的实现细节，依赖关系被颠倒（反转），从而使得低层次模块依赖于高层次模块的需求抽象。
该原则规定：
 高层次的模块不应该依赖于低层次的模块，两者都应该依赖于抽象接口。 抽象接口不应该依赖于具体实现。而具体实现则应该依赖于抽象接口。  "><meta name=generator content="Hugo 0.81.0"><link rel=canonical href=https://lixianwa.github.io/posts/go%E8%AF%AD%E8%A8%80solid%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97%E4%BA%94%E4%B9%8B%E4%BE%9D%E8%B5%96%E5%8F%8D%E8%BD%AC%E5%8E%9F%E5%88%99/><meta property="og:title" content="Go语言SOLID实践系列五之依赖反转原则"><meta property="og:description" content="引用wikipedia上对依赖反转原则的解释：

在面向对象编程领域中，依赖反转原则（Dependency inversion principle，DIP）是指一种特定的解耦（传统的依赖关系创建在高层次上，而具体的策略设置则应用在低层次的模块上）形式，使得高层次的模块不依赖于低层次的模块的实现细节，依赖关系被颠倒（反转），从而使得低层次模块依赖于高层次模块的需求抽象。
该原则规定：

高层次的模块不应该依赖于低层次的模块，两者都应该依赖于抽象接口。
抽象接口不应该依赖于具体实现。而具体实现则应该依赖于抽象接口。

"><meta property="og:type" content="article"><meta property="og:url" content="https://lixianwa.github.io/posts/go%E8%AF%AD%E8%A8%80solid%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97%E4%BA%94%E4%B9%8B%E4%BE%9D%E8%B5%96%E5%8F%8D%E8%BD%AC%E5%8E%9F%E5%88%99/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-22T10:05:19+08:00"><meta property="article:modified_time" content="2022-01-22T10:05:19+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go语言SOLID实践系列五之依赖反转原则"><meta name=twitter:description content="引用wikipedia上对依赖反转原则的解释：

在面向对象编程领域中，依赖反转原则（Dependency inversion principle，DIP）是指一种特定的解耦（传统的依赖关系创建在高层次上，而具体的策略设置则应用在低层次的模块上）形式，使得高层次的模块不依赖于低层次的模块的实现细节，依赖关系被颠倒（反转），从而使得低层次模块依赖于高层次模块的需求抽象。
该原则规定：

高层次的模块不应该依赖于低层次的模块，两者都应该依赖于抽象接口。
抽象接口不应该依赖于具体实现。而具体实现则应该依赖于抽象接口。

"><link rel=stylesheet href=/css/semantic.min.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/OverlayScrollbars.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/site.css><style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#f7f7f7;background-image:url(/me/background.jpeg)}body.dark{background-color:#000}</style><link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/gruvbox-light.min.css><link rel=stylesheet href=/css/custom.css></head><body class=default><nav class="ui secondary menu dream-menu"><div class=item><i class="large link bullseye icon dream-flip-toggle" title=翻转！></i></div><div class=item><i class="large link home icon" title=首页 onclick="window.location.href='https://lixianwa.github.io/'"></i></div><div class=item><i class="large link icon theme-switch" onclick=themeSwitch()></i></div><div class=item><i class="large link search icon" onclick=toggleSearch()></i></div></nav><div class=flip-container><div class=flipper><section class=front><div class=dream-max-width><div class="ui relaxed grid dream-grid dream-grid-single"><aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside"><div class="ui segment toc"><nav id=TableOfContents><ul><li><a href=#不遵守依赖反转原则>不遵守依赖反转原则</a></li><li><a href=#遵守依赖反转原则>遵守依赖反转原则</a></li><li><a href=#更多例子>更多例子</a></li><li><a href=#总结>总结</a></li></ul></nav></div><div class="ui segment actions"><button class="ui circular icon button save-as-image" title=保存为图片 onclick=savePostAsImg()>
<i class="save icon"></i></button>
<a href="https://twitter.com/intent/tweet?text=Go%e8%af%ad%e8%a8%80SOLID%e5%ae%9e%e8%b7%b5%e7%b3%bb%e5%88%97%e4%ba%94%e4%b9%8b%e4%be%9d%e8%b5%96%e5%8f%8d%e8%bd%ac%e5%8e%9f%e5%88%99&url=https%3a%2f%2flixianwa.github.io%2fposts%2fgo%25E8%25AF%25AD%25E8%25A8%2580solid%25E5%25AE%259E%25E8%25B7%25B5%25E7%25B3%25BB%25E5%2588%2597%25E4%25BA%2594%25E4%25B9%258B%25E4%25BE%259D%25E8%25B5%2596%25E5%258F%258D%25E8%25BD%25AC%25E5%258E%259F%25E5%2588%2599%2f" class="ui circular twitter icon button"><i class="twitter icon"></i></a><a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flixianwa.github.io%2fposts%2fgo%25E8%25AF%25AD%25E8%25A8%2580solid%25E5%25AE%259E%25E8%25B7%25B5%25E7%25B3%25BB%25E5%2588%2597%25E4%25BA%2594%25E4%25B9%258B%25E4%25BE%259D%25E8%25B5%2596%25E5%258F%258D%25E8%25BD%25AC%25E5%258E%259F%25E5%2588%2599%2f" class="ui circular facebook icon button"><i class="facebook icon"></i></a></div></aside><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img><section class="ui attached segment"><header><h1 class="ui large header">Go语言SOLID实践系列五之依赖反转原则<div class="sub header">@
归零
|
星期六，一月 22 日，2022 年
| 4 分钟阅读
| 更新于
星期六，一月 22 日，2022 年</div></h1></header><article class=main><p>引用wikipedia上对<a href=https://zh.wikipedia.org/wiki/%E4%BE%9D%E8%B5%96%E5%8F%8D%E8%BD%AC%E5%8E%9F%E5%88%99>依赖反转原则</a>的解释：</p><blockquote><p>在面向对象编程领域中，依赖反转原则（Dependency inversion principle，DIP）是指一种特定的解耦（传统的依赖关系创建在高层次上，而具体的策略设置则应用在低层次的模块上）形式，使得高层次的模块不依赖于低层次的模块的实现细节，依赖关系被颠倒（反转），从而使得低层次模块依赖于高层次模块的需求抽象。</p><p>该原则规定：</p><ul><li>高层次的模块不应该依赖于低层次的模块，两者都应该依赖于抽象接口。</li><li>抽象接口不应该依赖于具体实现。而具体实现则应该依赖于抽象接口。</li></ul></blockquote><h2 id=不遵守依赖反转原则>不遵守依赖反转原则</h2><blockquote><p>高层次的模块不应依赖于低层次的模块。两者都应该依赖于抽象。抽象不应依赖于细节。细节应该取决于抽象。</p></blockquote><p>我们可以在上面看到DIP的定义。Bob大叔在他的 <a href=https://web.archive.org/web/20110714224327/http://www.objectmentor.com/resources/articles/dip.pdf>论文</a>中提出了这一点。他的<a href=https://blog.cleancoder.com/uncle-bob/2016/01/04/ALittleArchitecture.html>博客</a>中还有更多细节。</p><p>那么，如何理解这一点，特别是在Go的上下文中？首先，我们应该接受抽象作为一个OOP概念。我们使用这样的概念来公开基本行为并隐藏其实现的细节。</p><p>什么是高层次和低层次模块？Go 上下文中的高层次模块是应用程序顶部使用的软件组件，如用于演示的代码。</p><p>它也可以是接近顶层的代码，如业务逻辑代码或某些用例组件。必须将其理解为为我们的应用程序提供真正业务价值的层。</p><p>另一方面，低层次组件大多是支持较高级别的小代码段。他们隐藏了有关不同基础设施集成的技术细节。例如，它可以是一个结构体，用于保留从数据库中检索数据、发送 SQS 消息、从 Redis 获取值或向外部 API 发送 HTTP 请求的逻辑。</p><p>那么，当我们打破依赖反转原则并且我们的高层次组件依赖于一个低层次组件时，它看起来如何？让我们看一下下面的代码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=color:#75715e>// infrastructure layer
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gorm</span>.<span style=color:#a6e22e>DB</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewUserRepository</span>(<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gorm</span>.<span style=color:#a6e22e>DB</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>UserRepository</span> {
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>UserRepository</span>{
		<span style=color:#a6e22e>db</span>: <span style=color:#a6e22e>db</span>,
	}
}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>UserRepository</span>) <span style=color:#a6e22e>GetByID</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>User</span>{}
	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Where</span>(<span style=color:#e6db74>&#34;id = ?&#34;</span>, <span style=color:#a6e22e>id</span>).<span style=color:#a6e22e>First</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>).<span style=color:#a6e22e>Error</span>
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>, <span style=color:#66d9ef>nil</span>
}

<span style=color:#75715e>// domain layer
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>ID</span> <span style=color:#66d9ef>uint</span> <span style=color:#e6db74>`gorm:&#34;primaryKey;column:id&#34;`</span>
	<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>}

<span style=color:#75715e>// application layer
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EmailService</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>repository</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>infrastructure</span>.<span style=color:#a6e22e>UserRepository</span>
	<span style=color:#75715e>// some email sender
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewEmailService</span>(<span style=color:#a6e22e>repository</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>infrastructure</span>.<span style=color:#a6e22e>UserRepository</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>EmailService</span> {
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>EmailService</span>{
		<span style=color:#a6e22e>repository</span>: <span style=color:#a6e22e>repository</span>,
	}
}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EmailService</span>) <span style=color:#a6e22e>SendRegistrationEmail</span>(<span style=color:#a6e22e>userID</span> <span style=color:#66d9ef>uint</span>) <span style=color:#66d9ef>error</span> {
	<span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>repository</span>.<span style=color:#a6e22e>GetByID</span>(<span style=color:#a6e22e>userID</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
	}
	<span style=color:#75715e>// send email
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><p>在上面的代码片段中，我们定义了一个高层次组件 EmailService。此结构体属于应用程序层，它负责向新注册客户发送电子邮件。</p><p>这个结构体是有一个方法SendRegistrationEmail，它需要用户的ID。在后台，它从 UserRepository 检索用户，稍后（可能）将其传递到某个 EmailSender 服务以执行电子邮件传递。</p><p>EmailSender的部分现在不在我们的关注点。让我们专注于用户存储库。该结构体表示与数据库通信的存储库，因此它属于基础设施层。</p><p>因此，我们的高层次组件 EmailService 似乎依赖于低级组件 UserRepository。实际上，如果不定义与数据库的连接，我们就无法启动用例结构。</p><p>这种反模式会立即影响我们在 Go 中的单元测试。让我们假设我们要测试电子邮件服务，如下面的代码片段所示：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;testing&#34;</span>
	<span style=color:#75715e>// some dependencies
</span><span style=color:#75715e></span>	<span style=color:#e6db74>&#34;github.com/DATA-DOG/go-sqlmock&#34;</span>
	<span style=color:#e6db74>&#34;github.com/stretchr/testify/assert&#34;</span>
	<span style=color:#e6db74>&#34;gorm.io/driver/mysql&#34;</span>
	<span style=color:#e6db74>&#34;gorm.io/gorm&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestEmailService_SendRegistrationEmail</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
	<span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>mock</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sqlmock</span>.<span style=color:#a6e22e>New</span>()
	<span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>NoError</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>)

	<span style=color:#a6e22e>dialector</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mysql</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>mysql</span>.<span style=color:#a6e22e>Config</span>{
		<span style=color:#a6e22e>DSN</span>:        <span style=color:#e6db74>&#34;dummy&#34;</span>,
		<span style=color:#a6e22e>DriverName</span>: <span style=color:#e6db74>&#34;mysql&#34;</span>,
		<span style=color:#a6e22e>Conn</span>:       <span style=color:#a6e22e>db</span>,
	})
	<span style=color:#a6e22e>finalDB</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorm</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>dialector</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>gorm</span>.<span style=color:#a6e22e>Config</span>{})
	
	<span style=color:#a6e22e>repository</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>infrastructure</span>.<span style=color:#a6e22e>NewUserRepository</span>(<span style=color:#a6e22e>finalDB</span>)
	<span style=color:#a6e22e>service</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewEmailService</span>(<span style=color:#a6e22e>repository</span>)
	<span style=color:#75715e>//
</span><span style=color:#75715e></span>	<span style=color:#75715e>// a lot of code to define mocked SQL queries
</span><span style=color:#75715e></span>	<span style=color:#75715e>//
</span><span style=color:#75715e></span>	<span style=color:#75715e>// and then actual test
</span><span style=color:#75715e></span>}
</code></pre></div><p>Go 中的mock依赖于接口的使用，我们可以为其定义mock实现，但我们不能对结构体执行相同的操作。</p><p>因此，我们不能嘲笑UserRepository，因为它是一个结构体。在这种情况下，我们需要在较低层次（在本例中）在 Gorm 连接对象上进行mock，我们可以使用 SQLMock 包执行此操作。</p><p>但即使有了它，它也不是一种可靠的，也不是有效的测试方法。我们需要mock太多的SQL查询，并且对数据库方案依赖太多。数据库内部的任何变化，我们都需要调整单元测试。</p><p>单元测试方面，现在我们有一个更大的问题。如果我们决定将存储切换到其他内容（如 Cassandra），会发生什么情况？主要是如果我们的存储对象是客户，我们计划在未来将存储作为分布式存储？</p><p>如果出现这样的场景，并且我们使用 UserRepository 的这个实现，那么接下来会进行许多重构。</p><p>现在，我们看到了高层组件的含义取决于低层组件的含义。但是依赖于细节的抽象呢？让我们检查下面的代码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go>
<span style=color:#75715e>// domain layer
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>ID</span> <span style=color:#66d9ef>uint</span> <span style=color:#e6db74>`gorm:&#34;primaryKey;column:id&#34;`</span>
	<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>interface</span> {
	<span style=color:#a6e22e>GetByID</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>)
}
</code></pre></div><p>要解决高层和低层组件的第一个问题，我们应该从定义一些接口开始。在这种情况下，我们可以将 UserRepository 定义为domain层上的接口。</p><p>因此，它提供了将电子邮件服务与数据库分离的机会，但仍未完全脱钩。查看用户结构。它仍然提出了映射到数据库的定义。</p><p>而且，即使这样的结构位于domain层内，它仍然具有基础结构细节。我们的新界面 UserRepository（抽象）依赖于用户结构和数据库方案（详细信息），我们仍然会中断 DIP。</p><p>更改数据库方案不可避免地会更改我们的接口。该接口仍可使用相同的 User 结构，但它将保存来自低级层的更改。</p><p>最后，通过这种重构，我们一无所获。我们仍然处于错误的位置。带来许多后果：</p><ul><li>我们无法正确测试我们的业务或应用程序逻辑。</li><li>对数据库引擎或表结构的任何更改都会影响我们的最高级别。</li><li>我们不能轻易切换到不同类型的存储。</li><li>我们的模型与存储紧密耦合。</li><li>&mldr;</li></ul><p>因此，让我们再次重构这段代码。</p><h2 id=遵守依赖反转原则>遵守依赖反转原则</h2><blockquote><p>高层模块不应依赖于低层模块。两者都应该依赖于抽象。抽象不应依赖于细节。细节应该取决于抽象。</p></blockquote><p>让我们回到依赖关系反转的原始指令，并检查粗体句子。他们已经给出了一些重构的方向。</p><p>我们应该定义一些抽象（一个接口），我们的组件EmailService和UserRepository都将依赖于这些抽象。此外，这种抽象不应依赖于任何技术细节（如Gorm对象）。</p><p>让我们从下面检查代码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=color:#75715e>// infrastructure layer
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserGorm</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>g</span> <span style=color:#a6e22e>UserGorm</span>) <span style=color:#a6e22e>ToUser</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>User</span> {
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>User</span>{
		<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>	}
}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserDatabaseRepository</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gorm</span>.<span style=color:#a6e22e>DB</span>
}

<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_</span> <span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>UserRepository</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>UserDatabaseRepository</span>{}

<span style=color:#75715e>/*
</span><span style=color:#75715e>type UserRedisRepository struct {
</span><span style=color:#75715e>	
</span><span style=color:#75715e>}
</span><span style=color:#75715e>type UserCassandraRepository struct {
</span><span style=color:#75715e>}
</span><span style=color:#75715e>*/</span>

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewUserDatabaseRepository</span>(<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gorm</span>.<span style=color:#a6e22e>DB</span>) <span style=color:#a6e22e>UserRepository</span> {
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>UserDatabaseRepository</span>{
		<span style=color:#a6e22e>db</span>: <span style=color:#a6e22e>db</span>,
	}
}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>UserDatabaseRepository</span>) <span style=color:#a6e22e>GetByID</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>UserGorm</span>{}
	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Where</span>(<span style=color:#e6db74>&#34;id = ?&#34;</span>, <span style=color:#a6e22e>id</span>).<span style=color:#a6e22e>First</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>).<span style=color:#a6e22e>Error</span>
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>ToUser</span>(), <span style=color:#66d9ef>nil</span>
}

<span style=color:#75715e>// domain layer
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>interface</span> {
	<span style=color:#a6e22e>GetByID</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>)
}

<span style=color:#75715e>// application layer
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EmailService</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>repository</span> <span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>UserRepository</span>
	<span style=color:#75715e>// some email sender
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewEmailService</span>(<span style=color:#a6e22e>repository</span> <span style=color:#a6e22e>domain</span>.<span style=color:#a6e22e>UserRepository</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>EmailService</span> {
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>EmailService</span>{
		<span style=color:#a6e22e>repository</span>: <span style=color:#a6e22e>repository</span>,
	}
}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EmailService</span>) <span style=color:#a6e22e>SendRegistrationEmail</span>(<span style=color:#a6e22e>userID</span> <span style=color:#66d9ef>uint</span>) <span style=color:#66d9ef>error</span> {
	<span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>repository</span>.<span style=color:#a6e22e>GetByID</span>(<span style=color:#a6e22e>userID</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
	}
	<span style=color:#75715e>// send email
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><p>在新的代码结构中，我们可以将 UserRepository 接口视为依赖于 User 结构的组件，并且它们都在domain层内。</p><p>用户结构体不再反映数据库方案，但我们为此使用UserGorm结构。该结构位于基础结构层上。它提供了一个 ToUser 方法，该方法将其映射到实际的用户结构。</p><p>在这种情况下，我们可以将 UserGorm 用作 UserDatabaseRepository 内部使用的详细信息的一部分，作为 UserRepository 的实际实现。</p><p>在domain和application中，我们仅依赖于domain中的 UserRepository 接口和用户实体。</p><p>在基础结构层中，我们可以根据需要为 UserRepository 定义尽可能多的实现。例如，这可以是UserFileRepository或UserCassandraRepository。</p><p>高层组件（EmailService）依赖于抽象 — 它包含一个类型为 UserRepository 的字段。不过，低层组件如何依赖于抽象？</p><p>在 Go 中，结构隐式实现接口。这意味着我们不需要添加 UserDatabaseRepository 显式实现 UserRepository 的代码，但我们可以添加一个具有空白标识符的检查。</p><p>通过这种方法，我们可以更轻松地控制依赖关系。我们的结构体依赖于接口，每当我们想要改变整体依赖关系时，我们都可以定义不同的实现并注入它们。</p><p>这种技术在任何框架中都很常见，我们用依赖注入模式来解决它。在 Go 中，有许多 DI 库，例如来自 Facebook的 Wire 或 Dingo 的库。</p><p>我们的单元测试情况如何？让我们来检查一下。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;errors&#34;</span>
	<span style=color:#e6db74>&#34;testing&#34;</span>
)

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>GetByIDFunc</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>)

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>f</span> <span style=color:#a6e22e>GetByIDFunc</span>) <span style=color:#a6e22e>GetByID</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>f</span>(<span style=color:#a6e22e>id</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestEmailService_SendRegistrationEmail</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
	<span style=color:#a6e22e>service</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewEmailService</span>(<span style=color:#a6e22e>GetByIDFunc</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>) {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;error&#34;</span>)
	}))
	<span style=color:#75715e>//
</span><span style=color:#75715e></span>	<span style=color:#75715e>// and just to call the service
</span><span style=color:#75715e></span>}
</code></pre></div><p>通过这种重构，我们可以提供一个简单的模拟，GetByIDFunc，作为一个新类型，它定义了我们想要模拟的UserRepository函数。以下是 Go 中定义函数类型并为其分配方法以实现接口的常用方法。</p><p>现在，我们的测试更加优雅和高效。我们可以为UserRepository注入不同的实现，用于任何用例，并控制测试结果。</p><h2 id=更多例子>更多例子</h2><p>我们可以体验到破坏其他组件中的 DIP，而不仅仅是结构。例如，可以使用纯独立的函数</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go>
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserJSON</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>j</span> <span style=color:#a6e22e>UserJSON</span>) <span style=color:#a6e22e>ToUser</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>User</span> {
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{
		<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>	}
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>filename</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;user_%d.json&#34;</span>, <span style=color:#a6e22e>id</span>)
	<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>filename</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}
	
	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>user</span> <span style=color:#a6e22e>UserJSON</span>
	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}
	
	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>ToUser</span>(), <span style=color:#66d9ef>nil</span>
}
</code></pre></div><p>因此，我们希望读取用户的数据。为此，我们可以使用文件和JSON格式。GetUser 方法从文件中读取文件并将文件内容转换为实际的 User。</p><p>该方法本身取决于文件的存在，如果我们想要正确测试它，我们需要依赖这些文件。因此，如果我们稍后将测试添加到 GetUser 方法中，则为此方法编写测试（例如，测试验证规则）并不方便。</p><p>再一次，我们的代码依赖于太多的细节，最好做一些抽象：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserJSON</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>j</span> <span style=color:#a6e22e>UserJSON</span>) <span style=color:#a6e22e>ToUser</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>User</span> {
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{
		<span style=color:#75715e>// some fields
</span><span style=color:#75715e></span>	}
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GetUserFile</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>filename</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;user_%d.json&#34;</span>, <span style=color:#a6e22e>id</span>)
	<span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>filename</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>file</span>, <span style=color:#66d9ef>nil</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GetUserHTTP</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>uri</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;http://some-api.com/users/%d&#34;</span>, <span style=color:#a6e22e>id</span>)
	<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>uri</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Body</span>, <span style=color:#66d9ef>nil</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GetDummyUser</span>(<span style=color:#a6e22e>userJSON</span> <span style=color:#a6e22e>UserJSON</span>) (<span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>userJSON</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>data</span>), <span style=color:#66d9ef>nil</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>reader</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>) {
	<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>ReadAll</span>(<span style=color:#a6e22e>reader</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>user</span> <span style=color:#a6e22e>UserJSON</span>
	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}

	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>ToUser</span>(), <span style=color:#66d9ef>nil</span>
}
</code></pre></div><p>通过新的实现，我们使 GetUser 方法依赖于 Reader 接口的实例。它是Go核心包IO的接口。</p><p>在这里，我们可以定义许多不同的方法来为Reader接口提供实现，例如GetUserFile，GetUserHTTP，GetDummyUser（我们可以使用它们来测试GetUser方法）。</p><p>这种方法我们可以在许多不同的情况下使用。每当我们在进行适当的单元测试时遇到困难，甚至在Go中遇到依赖循环时，我们都应该尝试通过提供接口和尽可能多的实现来解耦它。</p><h2 id=总结>总结</h2><p>依赖关系反转原则是最后一个 SOLID 原则，它代表单词 SOLID 中的字母 D。它指出高层组件不应依赖于低层组件。</p><p>相反，我们所有的组件都应该依赖于抽象，或者更好地说，接口。这样的抽象使我们能够更灵活地使用我们的代码，并对其进行适当的测试。</p><p>参考：</p><p>1、https://levelup.gitconnected.com/practical-solid-in-golang-dependency-inversion-principle-8cbd4eed484b</p><p>2、https://zh.wikipedia.org/wiki/%E4%BE%9D%E8%B5%96%E5%8F%8D%E8%BD%AC%E5%8E%9F%E5%88%99</p></article></section><article class="ui segment utterances-comments" data-html2canvas-ignore><script src=https://utteranc.es/client.js repo=lixianwa/comments-for-myblog issue-term=og:title theme=github-light crossorigin=anonymous async></script></article></div></div><footer class="ui basic center aligned segment" style=background-color:initial><p>© 2014 - 2022 Lionel's Blog</p><p>Powered by <a href=https://gohugo.io/ target=_blank>Hugo</a> with theme <a href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</p></footer></div></section><section class=back><div class=dream-max-width><header class="ui basic very padded segment dream-header"><div class="ui small circular image"><img src=/me/avatar.jpeg alt=avatar></div><div class=content><h1 class="ui medium header">归零的小窝<div class="sub header">收集、总结、分享</div></h1><article class="ui horizontal list"><a class=item href=/posts><i class="archive icon" title=归档></i></a><a class=item href=/categories><i class="th list icon" title=所有分类></i></a><a class=item href=/tags><i class="tags icon" title=所有标签></i></a></article><article class=dream-tags><a class="ui label" href=/tags/actor/ title=Actor>Actor</a>
<a class="ui label" href=/tags/archlinux/ title=archlinux>archlinux</a>
<a class="ui label" href=/tags/arthas/ title=arthas>arthas</a>
<a class="ui label" href=/tags/bug/ title=bug>bug</a>
<a class="ui label" href=/tags/c%E8%AF%AD%E8%A8%80/ title=c语言>c语言</a>
<a class="ui label" href=/tags/dapr/ title=Dapr>Dapr</a>
<a class="ui label" href=/tags/debug/ title=debug>debug</a>
<a class="ui label" href=/tags/dlv/ title=dlv>dlv</a>
<a class="ui label" href=/tags/docker/ title=Docker>Docker</a>
<a class="ui label" href=/tags/go/ title=Go>Go</a>
<a class="ui label" href=/tags/grpc/ title=gRPC>gRPC</a>
<a class="ui label" href=/tags/headless-service/ title="Headless service">Headless service</a>
<a class="ui label" href=/tags/hexo/ title=Hexo>Hexo</a>
<a class="ui label" href=/tags/ios/ title=iOS>iOS</a>
<a class="ui label" href=/tags/istio/ title=Istio>Istio</a>
<a class="ui label" href=/tags/java/ title=java>java</a>
<a class="ui label" href=/tags/jekyll/ title=jekyll>jekyll</a>
<a class="ui label" href=/tags/jupyter-notebook/ title="Jupyter notebook">Jupyter notebook</a>
<a class="ui label" href=/tags/kubernetes/ title=Kubernetes>Kubernetes</a>
<a class="ui label" href=/tags/letsencrypt/ title=Letsencrypt>Letsencrypt</a>
<a class="ui label" href=/tags/markdown/ title=markdown>markdown</a>
<a class="ui label" href=/tags/mongodb/ title=mongodb>mongodb</a>
<a class="ui label" href=/tags/nginx/ title=nginx>nginx</a>
<a class="ui label" href=/tags/pandas/ title=Pandas>Pandas</a>
<a class="ui label" href=/tags/reactivecocoa/ title=ReactiveCocoa>ReactiveCocoa</a>
<a class="ui label" href=/tags/redis/ title=redis>redis</a>
<a class="ui label" href=/tags/restful-api/ title="RESTFul API">RESTFul API</a>
<a class="ui label" href=/tags/solid/ title=SOLID>SOLID</a>
<a class="ui label" href=/tags/ssl%E8%AF%81%E4%B9%A6/ title=SSL证书>SSL证书</a>
<a class="ui label" href=/tags/swift/ title=Swift>Swift</a>
<a class="ui label" href=/tags/v2ray/ title=v2ray>v2ray</a>
<a class="ui label" href=/tags/xcode/ title=Xcode>Xcode</a>
<a class="ui label" href=/tags/%E5%86%85%E5%AD%98/ title=内存>内存</a>
<a class="ui label" href=/tags/%E5%8D%9A%E5%AE%A2/ title=博客>博客</a>
<a class="ui label" href=/tags/%E5%B7%A5%E5%85%B7/ title=工具>工具</a>
<a class="ui label" href=/tags/%E5%BC%80%E6%BA%90/ title=开源>开源</a>
<a class="ui label" href=/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ title=微服务>微服务</a>
<a class="ui label" href=/tags/%E6%8F%90%E9%97%AE/ title=提问>提问</a>
<a class="ui label" href=/tags/%E6%95%99%E7%A8%8B/ title=教程>教程</a>
<a class="ui label" href=/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ title=数据分析>数据分析</a>
<a class="ui label" href=/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/ title=数据库>数据库</a>
<a class="ui label" href=/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ title=最佳实践>最佳实践</a>
<a class="ui label" href=/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/ title=“机器学习”>“机器学习”</a>
<a class="ui label" href=/tags/%E6%AD%BB%E6%9C%BA/ title=死机>死机</a>
<a class="ui label" href=/tags/%E6%B3%9B%E5%9E%8B/ title=泛型>泛型</a>
<a class="ui label" href=/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/ title=“深度学习”>“深度学习”</a>
<a class="ui label" href=/tags/%E6%B8%B8%E8%AE%B0/ title=游记>游记</a>
<a class="ui label" href=/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/ title=科学上网>科学上网</a>
<a class="ui label" href=/tags/%E7%AE%97%E5%AD%90/ title=算子>算子</a>
<a class="ui label" href=/tags/%E7%BF%BB%E8%AF%91/ title=翻译>翻译</a>
<a class="ui label" href=/tags/%E8%87%AA%E8%A1%8C%E8%BD%A6/ title=自行车>自行车</a>
<a class="ui label" href=/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ title=读书笔记>读书笔记</a></article></div></header><div class="ui relaxed grid dream-grid dream-back"><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment markdown-body"><div class="ui medium header">关于</div><p>要么忙着生活，要么赶着去死!</p></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><div class="ui medium header">社交链接</div><nav class="ui secondary menu dream-menu dream-socials"><div class=item><a href=/index.xml><i class="large rss square icon" title=RSS></i></a></div><div class=item><a href=mailto:lixianwa@gmail.com><i class="large mail icon" title=Email></i></a></div></nav></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png></a><br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</article></div></div></div></section></div></div><script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=null,window.hasTwitterEmbed=null,window.hasTwitterEmbed&&(window.twttr=function(c,d,e){var b,f=c.getElementsByTagName(d)[0],a=window.twttr||{};return c.getElementById(e)?a:(b=c.createElement(d),b.id=e,b.src='https://platform.twitter.com/widgets.js',f.parentNode.insertBefore(b,f),a._e=[],a.ready=function(b){a._e.push(b)},a)}(document,'script','twitter-wjs'))</script><script src=/js/jquery.min.js></script><script src=/js/semantic.min.js></script><script src=/js/jquery.overlayScrollbars.min.js></script><script src=/js/header.js></script><script src=/js/main.js></script><script src=/js/theme.js></script><script src=/js/html2canvas.min.js></script><script src=/js/post.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script><script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var a=localStore.getItem('hugo-theme-dream-is-dark'),b,c,d;a=a?a:window.defaultDark?'y':a,b="gruvbox-light",c="gruvbox-dark",d=a==='y'?c:b,$('link[data-highlight]').attr('href','https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/'+d+'.min.css'),$('pre').css('background',a==='y'?'#333':'')}</script><div class="ui inverted segment" id=dream-search><div class="ui search"><div class="ui transparent input"><input class=prompt type=text placeholder=搜索></div><div class=results></div></div></div><script>$(document).ready(function(){$.getJSON('https://lixianwa.github.io//index.json',function(a){$('.ui.search').search({source:a,searchFields:['title'],showNoResults:!0})})})</script><script src=/js/search.js></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','172168556','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>